<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Sp4n9x" />
<meta name="renderer" content="webkit">
<meta name="google" value="notranslate">



<meta name="description" content="RAR文件格式分析突然心血来潮，分析了一下这个格式，在家无法专心学习，一篇文章拖了挺长时间。对RAR文件格式的细节有了更深刻的了解。">
<meta property="og:type" content="article">
<meta property="og:title" content="RAR文件格式分析">
<meta property="og:url" content="http://sp4n9x.github.io/2020/04/10/RAR文件格式分析/index.html">
<meta property="og:site_name" content="Sp4n9x&#39;s Blog">
<meta property="og:description" content="RAR文件格式分析突然心血来潮，分析了一下这个格式，在家无法专心学习，一篇文章拖了挺长时间。对RAR文件格式的细节有了更深刻的了解。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/SimpleRAR_env0.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/SimpleRAR_env1.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/MARK_HEAD.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/MAIN_HEAD.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/FILE_HEAD.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/FILE_HEAD1.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/END_HEAD.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/env0.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/env5.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/env1.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/env2.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/env3.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/env4.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/SFX1.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/SFX2.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/RAR%205.0%20signature.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/Archive%20encryption%20header.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/Main%20archive%20header.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/File%20header.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/End%20of%20archive%20header.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/Archive%20comment%20header.jpg">
<meta property="og:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/Quick%20open%20header.jpg">
<meta property="og:updated_time" content="2020-09-12T15:29:55.192Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RAR文件格式分析">
<meta name="twitter:description" content="RAR文件格式分析突然心血来潮，分析了一下这个格式，在家无法专心学习，一篇文章拖了挺长时间。对RAR文件格式的细节有了更深刻的了解。">
<meta name="twitter:image" content="http://sp4n9x.github.io/resources/2020/RAR_Format/SimpleRAR_env0.jpg">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternative" href="/atom.xml" title="Sp4n9x&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>RAR文件格式分析 | Sp4n9x&#39;s Blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?48aad015dbbeb363812643fd03e528c5";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Sp4n9x</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">留言板</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:sp4n9x@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="https://weibo.com/u/5721141892" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/Sp4n9x" title="GitHub"></a>
                            
                                <a class="fa 知乎" href="https://www.zhihu.com/people/pangx-cn/columns" title="知乎"></a>
                            
                                <a class="fa 网易云音乐" href="http://music.163.com/#/user/home?id=439043183" title="网易云音乐"></a>
                            
                            <!--
                            <div id="music163player">
                                <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=250 height=86 src="//music.163.com/outchain/player?type=2&id=535693399&auto=1&height=66">
                                </iframe>
                            </div>
                            -->
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AVI/">AVI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Adobe-Reader/">Adobe Reader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cinepak/">Cinepak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS隐蔽信道通信/">DNS隐蔽信道通信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FileFormat/">FileFormat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Got表覆写/">Got表覆写</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Heap-Overflow/">Heap Overflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Microsoft-Office/">Microsoft Office</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pdf/">Pdf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pwn/">Pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROP/">ROP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rtf/">Rtf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEH/">SEH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL注入/">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stack-Overflow/">Stack Overflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="//moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">Sp4n9x&#39;s 简介</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Sp4n9x</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Sp4n9x</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">留言板</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:sp4n9x@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="https://weibo.com/u/5721141892" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/Sp4n9x" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/pangx-cn/columns" title="知乎"></a>
                            
                                <a class="fa 网易云音乐" target="_blank" href="http://music.163.com/#/user/home?id=439043183" title="网易云音乐"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-RAR文件格式分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/04/10/RAR文件格式分析/" class="article-date">
      <time datetime="2020-04-09T16:00:00.000Z" itemprop="datePublished">2020-04-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      RAR文件格式分析
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/FileFormat/">FileFormat</a>
    </div>


        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
      
          
        <blockquote>
<p>RAR文件格式分析<br>突然心血来潮，分析了一下这个格式，在家无法专心学习，一篇文章拖了挺长时间。<br>对RAR文件格式的细节有了更深刻的了解。<br><a id="more"></a></p>
</blockquote>
<hr>
<h2 id="1、RAR简介"><a href="#1、RAR简介" class="headerlink" title="1、RAR简介"></a>1、RAR简介</h2><blockquote>
<p><strong><code>wikipedia:</code></strong><br>1、<a href="https://en.wikipedia.org/wiki/RAR_(file_format" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/RAR_(file_format</a>)<br>2、<a href="https://www.loc.gov/preservation/digital/formats/fdd/fdd000450.shtml" target="_blank" rel="noopener">https://www.loc.gov/preservation/digital/formats/fdd/fdd000450.shtml</a></p>
</blockquote>
<p>&emsp;&emsp;RAR是一种专利文件格式，用于<code>数据压缩</code>与<code>归档打包</code>，开发者为<code>尤金·罗谢尔</code>（俄语：Евгений Лазаревич Рошал，拉丁转写：Yevgeny Lazarevich Roshal），RAR的全名是“<code>Roshal ARchive</code>”，即“罗谢尔的归档”之意。首个公开版本<code>RAR 1.3</code>发布于1993年。<br>&emsp;&emsp;尤金·罗谢尔，1972年3月10日生于<code>俄罗斯</code>。毕业于俄罗斯车里雅宾斯克工业大学（Chelyabinsk Technical University，今南乌拉州立大学），也是<code>FAR文件管理器</code>的作者。他开发程序压缩或解压RAR文件，最初用于DOS，后来移植到其它平台。主要的Windows版本编码器，称为WinRAR，以共享软件的形式发行。不过罗谢尔公开了解码器源码，UnRAR解码器许可证以不许发布编译RAR兼容编码器为条件下允许有条件自由发布与修改，而RAR编码器一直是有专利的。<br>&emsp;&emsp;最近的开发者是尤金·罗谢尔的胞兄<code>亚历山大·罗谢尔</code>。虽然其解码器有专利，编译好的解压程序仍然存在于若干平台，例如开源的7-Zip。<br>&emsp;&emsp;RAR同时也拥有成熟的加密算法，<code>2.0 版本前</code>加密算法未公开，<code>2.0 版本后</code>使用AES算法加密，在没有密码情况下目前只有<code>暴力破解</code>。</p>
<p><strong><code>文件特点：</code></strong></p>
<ul>
<li>RAR通常情况比ZIP压缩比高，但压缩／解压缩速度较慢。</li>
<li><strong>分卷压缩：</strong>压缩后分割为多个文件。</li>
<li><strong>固实压缩：</strong>将要压缩的文件视为同一个文件以加大压缩比，代价是取用压缩包中任何文件需要解压整个压缩包。</li>
<li><strong>恢复记录：</strong>加入冗余数据用于修复，在压缩包本身损坏但恢复记录够多时可对损坏压缩包进行恢复。</li>
<li><strong>加密：</strong>RAR 2.0使用AES-128-CBC，RAR5.0以后为AES-256-CBC。之前RAR的加密算法为私有。当前除了暴力破解之外不存在（至少没有公开）有效的破解方法。</li>
</ul>
<h3 id="1-1、RAR的历史版本"><a href="#1-1、RAR的历史版本" class="headerlink" title="1.1、RAR的历史版本"></a>1.1、RAR的历史版本</h3><p>RAR文件格式的<code>修订历史记录</code>：</p>
<ul>
<li><strong><code>1.3</code></strong> 第一个公开版本，没有“ Rar！” 签名。</li>
<li><strong><code>1.5</code></strong> 更改未知。</li>
<li><strong><code>2.0</code></strong> 与WinRAR 2.0和Rar一起发布，用于MS-DOS 2.0。</li>
<li><strong><code>2.9</code></strong> 在WinRAR版本3.00中发布。</li>
<li><strong><code>5.0</code></strong> WinRAR 5.0及更高版本支持。</li>
</ul>
<p>WinRAR 5.0和Android的RAR将<code>2.9版本</code>称为<code>RAR4</code>。</p>
<hr>
<h2 id="2、RAR压缩文件格式分析"><a href="#2、RAR压缩文件格式分析" class="headerlink" title="2、RAR压缩文件格式分析"></a>2、RAR压缩文件格式分析</h2><h3 id="2-1、RAR-1-5-4-0文件格式分析"><a href="#2-1、RAR-1-5-4-0文件格式分析" class="headerlink" title="2.1、RAR 1.5 - 4.0文件格式分析"></a>2.1、RAR 1.5 - 4.0文件格式分析</h3><blockquote>
<p><strong><code>参考资料：</code></strong><br>1、<a href="http://acritum.com/winrar/rar-format" target="_blank" rel="noopener">http://acritum.com/winrar/rar-format</a><br>2、<a href="https://forensicswiki.xyz/page/RAR" target="_blank" rel="noopener">https://forensicswiki.xyz/page/RAR</a><br>3、<a href="https://blog.csdn.net/howeverpf/article/details/8909362" target="_blank" rel="noopener">https://blog.csdn.net/howeverpf/article/details/8909362</a><br>4、<a href="https://codedread.github.io/bitjs/docs/unrar.html" target="_blank" rel="noopener">https://codedread.github.io/bitjs/docs/unrar.html</a></p>
</blockquote>
<p><strong><code>实例环境：</code></strong> </p>
<div align="left"><img src="/resources/2020/RAR_Format/SimpleRAR_env0.jpg" width="50%" height="50%" alt="例子RAR文件环境0"></div><br><div align="left"><img src="/resources/2020/RAR_Format/SimpleRAR_env1.jpg" width="70%" height="50%" alt="例子RAR文件环境1"></div>

<p>&emsp;&emsp;压缩文件由<code>可变长度</code>的块组成。这些<code>块的顺序</code>可以变化，但是第一个块必须是<code>标记块</code>，然后是<code>压缩文件头块</code>。</p>
<p>&emsp;&emsp;现在公开的块类型有：<code>标记块</code>，<code>压缩文件头块</code>，<code>文件头块</code>，<code>注释头块</code>，<code>用户身份信息块</code>，<code>子块</code>和<code>恢复记录块</code>等。每一块的开始是由通用字段开始，且每一个不同的块的通用字段结构都是一样的。 </p>
<p><code>通用字段结构</code>如下表：</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">所有块或块部分的CRC</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">块类型</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">块标记</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">块大小</td>
</tr>
</tbody>
</table>
<p>如果块标记的第一位被置1的话(<code>(HEAD_FLAGS &amp; 0x8000)!= 0</code>)还存在：</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ADD_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">可选结构 - 增加块大小</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;所以文件大小的计算分两种情况，当块标记<code>HEAD_FLAGS</code>首位未置1，则总块大小就是<code>HEAD_SIZE</code>，当块标记<code>HEAD_FLAGS</code>首位置1，可选结构<code>ADD_SIZE</code>存在，则总块大小为<code>HEAD_SIZE</code>+<code>ADD_SIZE</code>。</p>
<p>&emsp;&emsp;在每个块中，<code>HEAD_FLAGS</code>中的以下位具有相同的含义：</p>
<blockquote>
<p><code>0x4000</code> - 如果设置，则较旧的RAR版本将忽略该块，并在更新存档时将其删除。如果清除，则在更新存档时将此块复制到新的存档文件；<br><code>0x8000</code> - 如果设置，则存在ADD_SIZE字段，且完整块大小为HEAD_SIZE + ADD_SIZE。</p>
</blockquote>
<p><strong><code>块类型：</code></strong></p>
<blockquote>
<ul>
<li><code>HEAD_TYPE = 0x72</code>  - MARK_HEAD(标记块)</li>
<li><code>HEAD_TYPE = 0x73</code>  - MAIN_HEAD(压缩文件头)</li>
<li><code>HEAD_TYPE = 0x74</code>  - FILE_HEAD(文件头)</li>
<li><code>HEAD_TYPE = 0x75</code>  - COMM_HEAD(旧风格的注释头)</li>
<li><code>HEAD_TYPE = 0x76</code>  - AV_HEAD(旧风格的授权信息块/用户身份信息块)</li>
<li><code>HEAD_TYPE = 0x77</code>  - SUB_HEAD(旧风格的子块)</li>
<li><code>HEAD_TYPE = 0x78</code>  -     PROTECT_HEAD(旧风格的恢复记录)</li>
<li><code>HEAD_TYPE = 0x79</code>  - SIGN_HEAD(旧风格的授权信息块/用户身份信息块)</li>
<li><code>HEAD_TYPE = 0x7A</code>  - NEWSUB_HEAD(子块)</li>
<li><code>HEAD_TYPE = 0x7B</code>  - ENDARC_HEAD(结束块)</li>
</ul>
</blockquote>
<h4 id="2-1-1、标记块-MARK-HEAD"><a href="#2-1-1、标记块-MARK-HEAD" class="headerlink" title="2.1.1、标记块( MARK_HEAD )"></a>2.1.1、标记块( MARK_HEAD )</h4><table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">总是0x6152</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x72</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">总是0x1A21</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">块大小 = 0x0007,即7个字节</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;所以这里标记块的大小固定是7 个字节，且是一个固定的字节序列。<code>标记块</code>也称为<code>Magic number</code>。</p>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/MARK_HEAD.jpg" alt="标记块"></p>
<h4 id="2-1-2、压缩文件头-MAIN-HEAD"><a href="#2-1-2、压缩文件头-MAIN-HEAD" class="headerlink" title="2.1.2、压缩文件头( MAIN_HEAD )"></a>2.1.2、压缩文件头( MAIN_HEAD )</h4><table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">HEAD_TYPE到RESERVED2的CRC</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x73</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">位标记：<br> <code>0x0001</code> - MHD_VOLUME: 卷属性(压缩文件卷) <br> <code>0x0002</code> - MHD_COMMENT: 压缩文件注释存在，RAR 3.x使用单独的注释块，不设置这个标记。 <br> <code>0x0004</code> - MHD_LOCK: 压缩文件锁定属性 <br> <code>0x0008</code> - MHD_SOLID: 固实属性(固实压缩文件) <br> <code>0x0010</code> - MHD_NEWNUMBERING: 新的卷命名法则(‘volname.partN.rar’) <br> <code>0x0020</code> - MHD_AV: 用户身份信息存在，RAR 3.x使用单独的用户身份信息块，不设置这个标记。 <br> <code>0x0040</code> - MHD_PROTECT: 恢复记录存在 <br> <code>0x0080</code> - HD_PASSWORD: 块头被加密 <br> <code>0x0100</code> - MHD_FIRSTVOLUME: 第一卷(只有RAR3.0及以后版本设置) <br> <code>0x0200</code> - MHD_ENCRYPTVER: <br> HEAD_FLAGS中的其他位保留用于内部使用。</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">压缩文件头总大小（包括压缩文件注释）</td>
</tr>
<tr>
<td style="text-align:left">RESERVED1</td>
<td style="text-align:center">2</td>
<td style="text-align:left">保留</td>
</tr>
<tr>
<td style="text-align:left">RESERVED2</td>
<td style="text-align:center">4</td>
<td style="text-align:left">保留</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;对于<code>压缩文件头</code>里的<code>位标记</code>，如果它的第9位(从左到右)被置1，块头被加密，也就是通常所说的<code>加密文件名</code>，打开这样加密的RAR文件时，需要先输入密码才能看到压缩包内的文件列表。</p>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/MAIN_HEAD.jpg" alt="压缩文件头"></p>
<p>&emsp;&emsp;这里头类型是0x73表示是<code>压缩文件头块</code>，位标记为0x0000未有位被置1，如果<code>块头被加密</code>则位标记应为0x0080，<code>文件头大小</code>为0x000D，所以这个<code>压缩文件头块</code>占用13 个字节，保留字节用0x00 填充。</p>
<h4 id="2-1-3、文件头-FILE-HEAD"><a href="#2-1-3、文件头-FILE-HEAD" class="headerlink" title="2.1.3、文件头( FILE_HEAD )"></a>2.1.3、文件头( FILE_HEAD )</h4><table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">&nbsp; 长度(byte) &nbsp;</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">从HEAD_TYPE到FILEATTR的CRC</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x74</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">位标记: <br> <code>0x0001</code> - LHD_SPLIT_BEFORE: 文件从上一卷继续 <br> <code>0x0002</code> - LHD_SPLIT_AFTER: 文件从后一卷继续 <br> <code>0x0004</code> - LHD_PASSWORD: 文件使用密码加密 <br> <code>0x0008</code> - LHD_COMMENT: 文件注释存在，RAR 3.x使用独立的注释块，不设置这个标记。 <br> <code>0x0010</code> - LHD_SOLID: 前一文件信息被使用(固实标记) (对于RAR 2.0 和以后版本) <br> &emsp;&emsp;7 6 5 位(对于RAR 2.0和以后版本) <br> &emsp;&emsp;0 0 0 - 字典大小 64KB <br> &emsp;&emsp;0 0 1 - 字典大小 128KB <br> &emsp;&emsp;0 1 0 - 字典大小 256KB <br> &emsp;&emsp;0 1 1 - 字典大小 512KB <br> &emsp;&emsp;1 0 0 - 字典大小 1024KB <br> &emsp;&emsp;1 0 1 - 字典大小 2048KB <br> &emsp;&emsp;1 1 0 - 字典大小 4096KB <br> &emsp;&emsp;1 1 1 - 文件作为字典 <br> <code>0x0100</code> - LHD_LARGE: HIGH_PACK_SIZE和HIGH_UNP_SIZE结构存在。这些结构仅用在非常大(大于2GB)的文档，对于小文件这些结构不存在。 <br> <code>0x0200</code> - LHD_UNICODE: FILE_NAME是用0隔开的包含普通的和Unicode编码的文件名。所以NAME_SIZE字段的值等于普通文件名的长度加Unicode编码文件名的长度再加1。如果此标记存在，但是FILE_NAME不包含0字节，它意味文件名使用UTF-8编码。 <br> <code>0x0400</code> - LHD_SALT: 文件头在文件名后包含附加的8byte，它对于增加加密的安全性是必需的。(所谓的’Salt’)。 <br> <code>0x0800</code> - LHD_VERSION: 版本标记。它是旧文件版本，版本号作为’;n’附加到文件名后。 <br> <code>0x1000</code> - LHD_EXTTIME: 扩展时间区域存在。  <br> <code>0x2000</code> - LHD_EXTFLAGS: <br> <code>0x8000</code> - 此位总被设置，所以完整的块的大小是HEAD_SIZE + PACK_SIZE(如果<code>0x100</code>位被设置，再加上HIGH_PACK_SIZE)</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">文件头的全部大小(包含文件名和注释)</td>
</tr>
<tr>
<td style="text-align:left">PACK_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">已压缩文件大小</td>
</tr>
<tr>
<td style="text-align:left">UNP_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">未压缩文件大小</td>
</tr>
<tr>
<td style="text-align:left">HOST_OS</td>
<td style="text-align:center">1</td>
<td style="text-align:left">保存压缩文件使用的操作系统 <br> <code>0x00</code> - MS DOS <br> <code>0x01</code> - OS/2 <br> <code>0x02</code> - Win32 <br> <code>0x03</code> - Unix <br> <code>0x04</code> - Mac OS <br> <code>0x05</code> - BeOS</td>
</tr>
<tr>
<td style="text-align:left">FILE_CRC</td>
<td style="text-align:center">4</td>
<td style="text-align:left">文件CRC</td>
</tr>
<tr>
<td style="text-align:left">FTIME</td>
<td style="text-align:center">4</td>
<td style="text-align:left">MS DOS标准格式的日期和时间</td>
</tr>
<tr>
<td style="text-align:left">UNP_VER</td>
<td style="text-align:center">1</td>
<td style="text-align:left">解压文件所需要最低RAR版本，版本编码方法：10 * 主版本 + 副版本。</td>
</tr>
<tr>
<td style="text-align:left">METHOD</td>
<td style="text-align:center">1</td>
<td style="text-align:left">压缩方式： <br> <code>0x30</code> - 存储 <br> <code>0x31</code> - 最快压缩 <br> <code>0x32</code> - 较快压缩 <br> <code>0x33</code> - 标准压缩 <br> <code>0x34</code> - 较好压缩 <br> <code>0x35</code> - 最好压缩</td>
</tr>
<tr>
<td style="text-align:left">NAME_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">文件名大小</td>
</tr>
<tr>
<td style="text-align:left">ATTR</td>
<td style="text-align:center">4</td>
<td style="text-align:left">文件属性</td>
</tr>
<tr>
<td style="text-align:left">HIGH_PACK_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">可选值，<code>已压缩文件大小</code>64位值的高4字节。只HEAD_FLAGS中的<code>0x100</code>位被设置才存在。</td>
</tr>
<tr>
<td style="text-align:left">HIGH_UNP_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">可选值，<code>未压缩文件大小</code>64位值的高4字节。只有HEAD_FLAGS中的<code>0x100</code>位被设置才存在。</td>
</tr>
<tr>
<td style="text-align:left">FILE_NAME</td>
<td style="text-align:center">NAME_SIZE</td>
<td style="text-align:left">文件名 - NAME_SIZE字节大小字符串</td>
</tr>
<tr>
<td style="text-align:left">SALT</td>
<td style="text-align:center">8</td>
<td style="text-align:left">可选值，如果(HEAD_FLAGS &amp; 0x400)!= 0，则存在</td>
</tr>
<tr>
<td style="text-align:left">EXT_TIME</td>
<td style="text-align:center">可变大小</td>
<td style="text-align:left">可选值，扩展时间区域，如果(HEAD_FLAGS &amp; 0x1000)!= 0，则存在</td>
</tr>
</tbody>
</table>
<p><strong><code>实例1：</code></strong><br><img src="/resources/2020/RAR_Format/FILE_HEAD.jpg" alt="文件头1"></p>
<p><strong><code>实例2：</code></strong><br><img src="/resources/2020/RAR_Format/FILE_HEAD1.jpg" alt="文件头2"></p>
<p>&emsp;&emsp;在这个块中，存在<code>两个CRC值</code>，一个是文件头块中从<code>块类型</code>到<code>文件名</code>这38(实例1)或40(实例2)个字节的校验，后一个则是压缩包中所含<code>文件的CRC校验</code>，解压时，会计算解压后生成文件的CRC值，如果等于这里的CRC，则解压完成，如果不同，则报错中断。<br>&emsp;&emsp;位标记<code>0x9020</code>(10010000 00100000B) = 0x0020 || 0x1000 || 0x8000，<code>0x0020</code>(字典大小 128KB)、<code>0x1000</code>(扩展时间区域存在)、<code>0x8000</code>(此位总被设置)。</p>
<h4 id="2-1-4、结尾块-ENDARC-HEAD"><a href="#2-1-4、结尾块-ENDARC-HEAD" class="headerlink" title="2.1.4、结尾块( ENDARC_HEAD )"></a>2.1.4、结尾块( ENDARC_HEAD )</h4><table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">从HEAD_TYPE 到HEAD_SIZE 的CRC校验值</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x7B</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">位标记</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">结尾块大小</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;与标记块类似的是，<code>结尾块</code>也是一个固定字节串的块，依次是<code>C4 3D 7B 00 40 07 00</code>。</p>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/END_HEAD.jpg" alt="结尾块"></p>
<p>&emsp;&emsp;<code>前一个文件块起始位置偏移</code>为81，而<code>前一个文件块的大小</code>是HEAD_SIZE + PACK_SIZE(0x002F + 0x153A = 0x1569) = 5481byte。所以<code>结尾块的偏移</code>为5481 + 81 = 5562。</p>
<h4 id="2-1-5、旧风格的块类型"><a href="#2-1-5、旧风格的块类型" class="headerlink" title="2.1.5、旧风格的块类型"></a>2.1.5、旧风格的块类型</h4><p>&emsp;&emsp; 除以上格式块以外，还存在一些旧风格的块类型，不过在新的版本中已经不存在了。</p>
<p><strong><code>旧风格的注释头块：</code></strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">从HEAD_TYPE 到COMM_CRC 的CRC校验值</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x75</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">位标记</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">注释头大小</td>
</tr>
<tr>
<td style="text-align:left">UNP_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">未压缩注释大小</td>
</tr>
<tr>
<td style="text-align:left">UNP_VER</td>
<td style="text-align:center">1</td>
<td style="text-align:left">提取注释的RAR最低版本</td>
</tr>
<tr>
<td style="text-align:left">METHOD</td>
<td style="text-align:center">1</td>
<td style="text-align:left">压缩方法</td>
</tr>
<tr>
<td style="text-align:left">COMM_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">注释CRC</td>
</tr>
<tr>
<td style="text-align:left">COMMENT</td>
<td style="text-align:center">N</td>
<td style="text-align:left">注释正文</td>
</tr>
</tbody>
</table>
<p><strong><code>旧风格的授权信息块/用户身份信息块：</code></strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">从HEAD_TYPE 到HEAD_SIZE的CRC校验值</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x76</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">位标记</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">块大小</td>
</tr>
<tr>
<td style="text-align:left">INFO</td>
<td style="text-align:center">N</td>
<td style="text-align:left">授权信息/用户身份信息正文</td>
</tr>
</tbody>
</table>
<p><strong><code>旧风格的子块：</code></strong><br>&emsp;&emsp; 在压缩文件中<code>任意文件头块</code>后面都可以附加一个<code>子块</code>。这个子块依赖于它前面的这个<code>主块</code>。当更新时新版本的RAR压缩包可能会删除或者移动这个子块。</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">块CRC</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x77</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">位标记</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">总块大小</td>
</tr>
<tr>
<td style="text-align:left">DATA_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">总数据块大小</td>
</tr>
<tr>
<td style="text-align:left">SUB_TYPE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">子块类型</td>
</tr>
<tr>
<td style="text-align:left">RESERVED</td>
<td style="text-align:center">1</td>
<td style="text-align:left">保留字段，必须为0</td>
</tr>
<tr>
<td style="text-align:left">其余字段</td>
<td style="text-align:center"></td>
<td style="text-align:left">由SUB_TYPE 决定其余字段类型</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp; 以<code>SUB_TYPE</code>为0x100为例，0x100定义子块类型为<code>扩展属性类型</code>，一般用于压缩一些文件属性信息较详细的文件。</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">长度(byte)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HEAD_CRC</td>
<td style="text-align:center">2</td>
<td style="text-align:left">块CRC</td>
</tr>
<tr>
<td style="text-align:left">HEAD_TYPE</td>
<td style="text-align:center">1</td>
<td style="text-align:left">0x77</td>
</tr>
<tr>
<td style="text-align:left">HEAD_FLAGS</td>
<td style="text-align:center">2</td>
<td style="text-align:left">位标记</td>
</tr>
<tr>
<td style="text-align:left">HEAD_SIZE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">总块大小</td>
</tr>
<tr>
<td style="text-align:left">DATA_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">总数据块大小</td>
</tr>
<tr>
<td style="text-align:left">SUB_TYPE</td>
<td style="text-align:center">2</td>
<td style="text-align:left">子块类型，定义子块为扩展属性类型</td>
</tr>
<tr>
<td style="text-align:left">RESERVED</td>
<td style="text-align:center">1</td>
<td style="text-align:left">保留字段，必须为0。以上为子块中固定格式</td>
</tr>
<tr>
<td style="text-align:left">UNP_SIZE</td>
<td style="text-align:center">4</td>
<td style="text-align:left">未压缩扩展属性大小。以下为扩展属性附加字段。</td>
</tr>
<tr>
<td style="text-align:left">UNP_VER</td>
<td style="text-align:center">1</td>
<td style="text-align:left">提取扩展属性的RAR最低版本</td>
</tr>
<tr>
<td style="text-align:left">METHOD</td>
<td style="text-align:center">1</td>
<td style="text-align:left">压缩方式</td>
</tr>
<tr>
<td style="text-align:left">EA_CRC</td>
<td style="text-align:center">4</td>
<td style="text-align:left">扩展属性CRC</td>
</tr>
</tbody>
</table>
<h3 id="2-2、RAR-5-文件格式分析"><a href="#2-2、RAR-5-文件格式分析" class="headerlink" title="2.2、RAR 5+文件格式分析"></a>2.2、RAR 5+文件格式分析</h3><blockquote>
<p><strong><code>参考资料：</code></strong><br>1、<a href="https://www.rarlab.com/technote.htm" target="_blank" rel="noopener">https://www.rarlab.com/technote.htm</a></p>
</blockquote>
<p>&emsp;&emsp;Here we describe basic data structures of archive format introduced in RAR 5.0. If you need information about algorithms or more detailed information on data structures, please use UnRAR source code.<br>&emsp;&emsp;在这里，我们描述了<code>RAR 5.0</code>中引入的存档格式的<code>基本数据结构</code>。如果您需要有关算法的信息或有关数据结构的更多详细信息，请使用<code>UnRAR</code>源代码。</p>
<p><strong><code>实例环境：</code></strong></p>
<div align="left"><img src="/resources/2020/RAR_Format/env0.jpg" align:"left"="" width="50%" height="50%" alt="例子RAR文件环境0"><img src="/resources/2020/RAR_Format/env5.jpg" align:"right"="" width="50%" height="50%" alt="例子RAR文件环境1"></div><br><div align="left"><img src="/resources/2020/RAR_Format/env1.jpg" align:"left"="" width="50%" height="50%" alt="例子RAR文件环境2"><img src="/resources/2020/RAR_Format/env2.jpg" align:"right"="" width="50%" height="50%" alt="例子RAR文件环境3"></div><br><div align="left"><img src="/resources/2020/RAR_Format/env3.jpg" width="50%" height="50%" alt="例子RAR文件环境4"></div><br><div align="left"><img src="/resources/2020/RAR_Format/env4.jpg" width="80%" height="60%" alt="例子RAR文件环境5"></div>

<p>设置的密码<code>未加密文件名</code>。</p>
<h4 id="2-2-1、Data-types-数据类型"><a href="#2-2-1、Data-types-数据类型" class="headerlink" title="2.2.1、Data types(数据类型)"></a>2.2.1、Data types(数据类型)</h4><p><strong><code>vint</code></strong><br>&emsp;&emsp;Variable length integer. Can include one or more bytes, where lower 7 bits of every byte contain integer data and highest bit in every byte is the continuation flag. If highest bit is 0, this is the last byte in sequence. So first byte contains 7 least significant bits of integer and continuation flag. Second byte, if present, contains next 7 bits and so on.<br>&emsp;&emsp;<code>可变长度</code>整数。可以包含<code>一个</code>或<code>多个</code>字节，其中每个字节的<code>低7位</code>包含整数数据，而每个字节中的<code>最高位</code>是连续标志。如果<code>最高位为0</code>，则这是序列中的最后一个字节。因此，第一个字节包含<code>低位7个有效位的整数</code>和<code>连续标志</code>。第二个字节（如果存在）包含下一个7位，依此类推。<br>&emsp;&emsp;Currently RAR format uses vint to store up to 64 bit integers, resulting in 10 bytes maximum. This value may be increased in the future if necessary for some reason.<br>&emsp;&emsp;当前的RAR格式使用<code>vint</code>最多存储<code>64位</code>整数，所以<code>vint</code>最大可以包含<code>10个字节</code>。如果出于某种原因，将来可能会增加此值。<br>&emsp;&emsp;Sometimes RAR needs to pre-allocate space for vint before knowing its exact value. In such situation it can allocate more space than really necessary and then fill several leading bytes with 0x80 hexadecimal, which means 0 with continuation flag set.<br>&emsp;&emsp;有时，RAR需要在知道确切值之前为<code>vint</code>预先分配空间。在这种情况下，它可以分配<code>超出</code>实际需要的空间，然后用<code>0x80</code>十六进制填充几个前导字节，这意味着设置了<code>连续标志</code>。</p>
<p><strong><code>byte</code></strong>, <strong><code>uint16</code></strong>, <strong><code>uint32</code></strong>, <strong><code>uint64</code></strong><br>Byte, 16-, 32-, 64- bit unsigned integer in little endian format.<br><code>Byte</code>，<code>16bit</code>、<code>32bit</code>、<code>64bit</code>的无符号整型使用的都是<code>小端存储格式</code>。</p>
<p><strong><code>Variable length data(可变长度的数据)</code></strong><br>We use ellipsis … to denote variable length data areas.<br>我们使用<code>省略号(...)</code>表示<code>可变长度</code>的数据区域。</p>
<p><strong><code>Hexadecimal values(十六进制值)</code></strong><br>We use 0x prefix to define hexadecimal values, such as 0xf000.<br>我们使用0x前缀定义十六进制值，例如<code>0xf000</code>。</p>
<h4 id="2-2-2、General-archive-structure-通用压缩文档结构"><a href="#2-2-2、General-archive-structure-通用压缩文档结构" class="headerlink" title="2.2.2、General archive structure(通用压缩文档结构)"></a>2.2.2、General archive structure(通用压缩文档结构)</h4><p><strong><code>General archive block format(通用压缩文档块格式)</code></strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Header CRC32</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">头数据的CRC32，从“<code>Header size</code>”字段开始，直至“<code>Extra area</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">头数据的大小，从“<code>Header type</code>”字段开始，直至“<code>Extra area</code>”字段。在当前的实现中，该字段不得超过<code>3个字节</code>，从而导致最大的头大小为<code>2MB</code>。</td>
</tr>
<tr>
<td style="text-align:left">Header type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">压缩文档头的类型。可能的值为：<br> &emsp;&emsp;<code>0x01</code> - 压缩文档头。<br> &emsp;&emsp;<code>0x02</code> - 文件头。<br> &emsp;&emsp;<code>0x03</code> - 服务头。<br> &emsp;&emsp;<code>0x04</code> - 压缩文档加密头。<br> &emsp;&emsp;<code>0x05</code> - 结尾块。</td>
</tr>
<tr>
<td style="text-align:left">Header flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">所有头共有的标志：<br> <code>0x01</code> - 头末尾存在扩展区域。<br> <code>0x02</code> - 头末尾存在数据区域。<br> <code>0x04</code> - 当更新压缩文档时，必须跳过类型未知并拥有该标志的块。<br> <code>0x08</code> - 数据区域从上一卷继续。<br> <code>0x10</code> - 数据区域从下一卷继续。<br> <code>0x20</code> - 块取决于前一个文件块。<br> <code>0x40</code> - 如果修改了主块，则保留一个子块。</td>
</tr>
<tr>
<td style="text-align:left">Extra area size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，扩展区域的大小。仅当设置了<code>0x01</code>头标志时才存在。</td>
</tr>
<tr>
<td style="text-align:left">Data area size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，数据区域的大小。仅当设置了<code>0x02</code>头标志时才存在。</td>
</tr>
<tr>
<td style="text-align:left">…</td>
<td style="text-align:center">…</td>
<td style="text-align:left">当前块类型专用的字段。有关详细信息，请参见具体块类型描述。</td>
</tr>
<tr>
<td style="text-align:left">Extra area</td>
<td style="text-align:center">…</td>
<td style="text-align:left"><code>可选字段</code>，扩展区域。仅当设置了<code>0x01</code>头标志时才存在。</td>
</tr>
<tr>
<td style="text-align:left">Data area</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，数据区域。仅当设置了<code>0x02</code>头标志时才存在。用于存储大量数据，例如压缩文件数据。不包括“<code>Header CRC</code>”和“<code>Header size</code>”字段。</td>
</tr>
</tbody>
</table>
<p><strong><code>General extra area format(通用扩展区域格式)</code></strong><br>Extra area can include one or more records having the following format:<br>扩展区域可以包含一个或多个具有以下格式的记录：</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>记录类型</code>。不同的压缩文档块具有不同的关联的扩展区域记录类型。阅读具体的压缩文档块描述以获取详细信息。将来可以添加新的记录类型，因此需要跳过未知的记录类型而不中断操作。</td>
</tr>
<tr>
<td style="text-align:left">Data</td>
<td style="text-align:center">…</td>
<td style="text-align:left"><code>记录相关数据</code>。如果记录仅由Size和Type组成，则可能会丢失。</td>
</tr>
</tbody>
</table>
<p><strong><code>General archive layout(通用压缩文档布局)</code></strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Self-extracting module(optional)：自解压模块(可选的)</span><br><span class="line">RAR 5.0 signature：RAR5.0签名</span><br><span class="line">Archive encryption header(optional)：压缩文档加密头(可选的)</span><br><span class="line">Main archive header：压缩文档头</span><br><span class="line">Archive comment service header(optional)：压缩文档注释服务头(可选的)</span><br><span class="line"></span><br><span class="line">File header 1：文件头1</span><br><span class="line">Service headers(NTFS ACL, streams, etc.)<span class="keyword">for</span> preceding file(optional)：前一个文件的服务头(可选的)</span><br><span class="line">...</span><br><span class="line">File header N：文件头N</span><br><span class="line">Service headers(NTFS ACL, streams, etc.)<span class="keyword">for</span> preceding file(optional)：前一个文件的服务头(可选的)</span><br><span class="line"></span><br><span class="line">Recovery record(optional)：恢复记录(可选的)</span><br><span class="line">End of archive header：结尾块</span><br></pre></td></tr></table></figure></p>
<h4 id="2-2-3、Archive-blocks-压缩文档块"><a href="#2-2-3、Archive-blocks-压缩文档块" class="headerlink" title="2.2.3、Archive blocks(压缩文档块)"></a>2.2.3、Archive blocks(压缩文档块)</h4><h5 id="2-2-3-1、Self-extracting-module-SFX-自解压模块"><a href="#2-2-3-1、Self-extracting-module-SFX-自解压模块" class="headerlink" title="2.2.3.1、Self-extracting module (SFX)(自解压模块)"></a>2.2.3.1、<strong><code>Self-extracting module (SFX)(自解压模块)</code></strong></h5><p>&emsp;&emsp;Any data preceding the archive signature. Self-extracting module size and contents is not defined. At the moment of writing this documentation RAR assumes the maximum SFX module size to not exceed 1 MB, but this value can be increased in the future.<br>&emsp;&emsp;<code>压缩文档签名</code>之前的所有数据。<code>自解压模块</code>的大小和内容未定义。在撰写本文档时，RAR假定<code>SFX模块</code>的最大大小不超过1 MB，但是以后可以增加该值。</p>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/SFX1.jpg" alt="自解压模块头"><br><img src="/resources/2020/RAR_Format/SFX2.jpg" alt="自解压模块尾"></p>
<h5 id="2-2-3-2、RAR-5-0-signature-RAR5-0签名"><a href="#2-2-3-2、RAR-5-0-signature-RAR5-0签名" class="headerlink" title="2.2.3.2、RAR 5.0 signature(RAR5.0签名)"></a>2.2.3.2、<strong><code>RAR 5.0 signature(RAR5.0签名)</code></strong></h5><p>&emsp;&emsp;RAR 5.0 signature consists of 8 bytes: 0x52 0x61 0x72 0x21 0x1A 0x07 0x01 0x00. You need to search for this signature in supposed archive from beginning and up to maximum SFX module size. Just for comparison this is RAR 4.x 7 byte length signature: 0x52 0x61 0x72 0x21 0x1A 0x07 0x00.<br>&emsp;&emsp;<code>RAR 5.0签名</code>由8个字节组成：<code>0x52 0x61 0x72 0x21 0x1A 0x07 0x01 0x00</code>。您需要从假想的压缩文档中搜索该签名，从开始到最大SFX模块大小。只是为了比较，这是<code>RAR 4.x</code> 7字节长度的签名：<code>0x52 0x61 0x72 0x21 0x1A 0x07 0x00</code>。</p>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/RAR 5.0 signature.jpg" alt="RAR 5.0签名"></p>
<h5 id="2-2-3-3、Archive-encryption-header-压缩文档加密块"><a href="#2-2-3-3、Archive-encryption-header-压缩文档加密块" class="headerlink" title="2.2.3.3、Archive encryption header(压缩文档加密块)"></a>2.2.3.3、<strong><code>Archive encryption header(压缩文档加密块)</code></strong></h5><table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Header CRC32</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">头数据的CRC32，从“<code>Header size</code>”字段开始，直至“<code>Check value</code>”字段的CRC32校验码。</td>
</tr>
<tr>
<td style="text-align:left">Header size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">头数据的大小，从“<code>Header type</code>”字段开始，直至“<code>Check value</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x04</code></td>
</tr>
<tr>
<td style="text-align:left">Header flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">所有头共有的标志：<br> <code>0x01</code> - 头末尾存在扩展区域。<br> <code>0x02</code> - 头末尾存在数据区域。<br> <code>0x04</code> - 当更新压缩文档时，必须跳过类型未知并拥有该标志的块。<br> <code>0x08</code> - 数据区域从上一卷继续。<br> <code>0x10</code> - 数据区域从下一卷继续。<br> <code>0x20</code> - 块取决于前一个文件块。<br> <code>0x40</code> - 如果修改了主块，则保留一个子块。</td>
</tr>
<tr>
<td style="text-align:left">Encryption version</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>加密算法的版本</code>。现在仅支持0版本(AES-256)。</td>
</tr>
<tr>
<td style="text-align:left">Encryption flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x00</code> - 不存在密码检查数据(Check value字段)。 <br> <code>0x01</code> - 存在密码检查数据(Check value字段)。</td>
</tr>
<tr>
<td style="text-align:left">KDF count</td>
<td style="text-align:center">1 byte</td>
<td style="text-align:left"><code>PBKDF2函数</code>的<code>迭代数</code>的<code>二进制对数</code>。 RAR可以拒绝处理<code>超过</code>某个阈值的KDF计数。阈值的具体值取决于<code>版本</code>。</td>
</tr>
<tr>
<td style="text-align:left">Salt</td>
<td style="text-align:center">16 byte</td>
<td style="text-align:left">全局地用于<code>所有加密</code>的压缩文档头的盐值。</td>
</tr>
<tr>
<td style="text-align:left">Check value</td>
<td style="text-align:center">12 byte</td>
<td style="text-align:left">用于<code>验证密码有效性</code>的值。仅当设置了<code>0x01</code>加密标志时才存在。<code>前8个字节</code>是使用额外的PBKDF2轮次计算的，<code>最后4个字节</code>是额外的校验和。与标准<code>Header CRC32</code>一起，我们具有<code>64位校验和</code>，以可靠地<code>验证此字段的完整性</code>并区分<code>无效的密码</code>和<code>损坏的数据</code>。可以在UnRAR源代码中找到更多详细信息。</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;This header is present only in archives with encrypted headers. Every next header after this one is started from 16 byte AES-256 initialization vector followed by encrypted header data. Size of encrypted header data block is aligned to 16 byte boundary.<br>&emsp;&emsp;该头仅存在于<code>带有加密头</code>的压缩文档中。此后的<code>每下一个头</code>均从16字节<code>AES-256初始化向量</code>开始，然后是<code>加密的头数据</code>。加密头数据块的大小与16字节边界对齐。</p>
<p><strong><code>实例：</code></strong><br>这是设置密码时勾选了<code>加密文件名</code>后，出现的块。<br><img src="/resources/2020/RAR_Format/Archive encryption header.jpg" alt="压缩文档加密块"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">00000000 - 00310783 SFX(自解压模块)</span><br><span class="line"></span><br><span class="line">00310784 - 00310791</span><br><span class="line">52 61 72 21 1A 07 01 00</span><br><span class="line"></span><br><span class="line">00310792 - 00310829</span><br><span class="line">49 23 54 91 - Header CRC32( Header size -&gt; Check value )</span><br><span class="line">21 - Header size( Header <span class="built_in">type</span> -&gt; Check value ) 21H = 33D</span><br><span class="line">04 - Header <span class="built_in">type</span>( 压缩文档加密块 )</span><br><span class="line">00 - Header flags</span><br><span class="line">00 - Encryption version</span><br><span class="line">01 - Encryption flags</span><br><span class="line">0F - KDF count</span><br><span class="line">89 54 B1 34 4A 94 3D 09 FA 1A CB 8A C8 A9 F3 A3 - Salt</span><br><span class="line">21 43 42 86 61 24 8A 16 E4 1B C8 8E - Check value</span><br></pre></td></tr></table></figure>
<h5 id="2-2-3-4、Main-archive-header-压缩文件头"><a href="#2-2-3-4、Main-archive-header-压缩文件头" class="headerlink" title="2.2.3.4、Main archive header(压缩文件头)"></a>2.2.3.4、<strong><code>Main archive header(压缩文件头)</code></strong></h5><table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Header CRC32</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">头数据的CRC32，从“<code>Header size</code>”字段开始，直至“<code>Extra area</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">头数据的大小，从“<code>Header type</code>”字段开始，直至“<code>Extra area</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code></td>
</tr>
<tr>
<td style="text-align:left">Header flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">所有头共有的标志：<br> <code>0x01</code> - 头末尾存在扩展区域。<br> <code>0x02</code> - 头末尾存在数据区域。<br> <code>0x04</code> - 当更新压缩文档时，必须跳过类型未知并拥有该标志的块。<br> <code>0x08</code> - 数据区域从上一卷继续。<br> <code>0x10</code> - 数据区域从下一卷继续。<br> <code>0x20</code> - 块取决于前一个文件块。<br> <code>0x40</code> - 如果修改了主块，则保留一个子块。</td>
</tr>
<tr>
<td style="text-align:left">Extra area size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，扩展区域的大小。仅当设置了<code>0x01</code>头标志时才存在。</td>
</tr>
<tr>
<td style="text-align:left">Archive flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code> - 卷。压缩文档是多卷集的一部分。 <br> <code>0x02</code> - “Volume number”字段存在。除第一卷外，所有的卷都存在此标志。 <br> <code>0x04</code> - 可靠的压缩文档。 <br> <code>0x08</code> - 存在恢复记录。 <br> <code>0x10</code> - 压缩文档已锁定。</td>
</tr>
<tr>
<td style="text-align:left">Volume number</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，仅当设置了Archive flags的<code>0x02</code>位时才显示。第一卷不存在，第二卷为1，第三卷为2，依此类推。</td>
</tr>
<tr>
<td style="text-align:left">Extra area</td>
<td style="text-align:center">…</td>
<td style="text-align:left"><code>可选字段</code>，扩展区域。仅当设置了<code>0x01</code>头标志时才存在。</td>
</tr>
</tbody>
</table>
<p>Extra area of main archive header can contain following record types：<br><code>压缩文件头</code>的<code>扩展区域</code>可以包含以下记录类型：</p>
<table>
<thead>
<tr>
<th style="text-align:left">类型编号</th>
<th style="text-align:left">类型名称</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0x01</td>
<td style="text-align:left">Locator</td>
<td style="text-align:left">包含<code>不同服务块</code>的位置，因此可以<code>快速访问</code>它们，而无需扫描整个压缩文档。该记录是<code>可选的</code>。如果缺少它，仍然有必要扫描<code>整个压缩文件</code>以验证服务块的存在。</td>
</tr>
</tbody>
</table>
<p><strong><code>Locator record(定位记录)</code></strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code></td>
</tr>
<tr>
<td style="text-align:left">Flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code> - “Quick open record offset”字段存在。 <br> <code>0x02</code> - “Recovery record offset”字段存在。</td>
</tr>
<tr>
<td style="text-align:left">Quick open offset</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，从<code>“Quick open”服务块的开始</code>到<code>Main archive header的开始</code>的距离。仅当设置了<code>0x01</code>标志时才存在。如果等于0，则应忽略。如果预分配的空间不足以存储产生的偏移量，则可以将其设置为零。</td>
</tr>
<tr>
<td style="text-align:left">Recovery record offset</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，从<code>“Recovery record”服务块的开始</code>到<code>Main archive header的开始</code>的距离。仅当设置了<code>0x02</code>标志时才存在。如果等于0，则应忽略。如果预分配的空间不足以存储产生的偏移量，则可以将其设置为零。</td>
</tr>
</tbody>
</table>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/Main archive header.jpg" alt="压缩文件头"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">00310792 - 00310811</span><br><span class="line">49 64 D1 32 - Header CRC32( Header size -&gt; Extra area )</span><br><span class="line">0F - Header size( Header <span class="built_in">type</span> -&gt; Extra area ) 0FH = 15D</span><br><span class="line">01 - Header <span class="built_in">type</span>( 压缩文件头 )</span><br><span class="line">05 - Header flags( 0x05 = 0x01 + 0x04 )</span><br><span class="line">0B - Extra area size( 0BH = 11D )</span><br><span class="line">18 - Archive flags( 0x18 = 0x10 + 0x08 )</span><br><span class="line">0A - Size[ Extra area ] 0AH = 10D</span><br><span class="line">01 - Type( Locator record )</span><br><span class="line">03 - Flags( 0x03 = 0x01 + 0x02 )</span><br><span class="line">A3 C7 81 00 - Quick open offset</span><br><span class="line">DB C8 81 00 - Recovery record offset</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">Note: vint类型的数据，如果是多字节的，前几个字节的最高位为连续标志</span><br><span class="line">(设为1)，低7位为数据，最后一个字节的最高位为0，低7位依旧是数据。所</span><br><span class="line">以我们需要提取出数据，进行重新组合，才能得到“Quick open header”</span><br><span class="line">和“Recovery record”真实偏移。</span><br><span class="line">1、Quick open offset</span><br><span class="line">0x0081C7A3( 00000000 10000001 ‭11000111‬ ‭10100011 ‬)</span><br><span class="line">0000001 1000111‬ 0100011‬B = 01100011 1‬0100011‬B = 63A3H = ‭25507‬D</span><br><span class="line">310792 + 25507 = 336299</span><br><span class="line">2、Recovery record offset</span><br><span class="line">0x0081C8DB( ‭00000000 10000001 11001000 11011011 ‬)</span><br><span class="line">0000001 1001000 1011011‬B = 01100100 01011011‬B = 645BH = ‭25691‬D</span><br><span class="line">310792 + ‭25691‬ = ‭336483‬</span><br><span class="line">---------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h5 id="2-2-3-5、File-header-and-service-header-文件头和服务头"><a href="#2-2-3-5、File-header-and-service-header-文件头和服务头" class="headerlink" title="2.2.3.5、File header and service header(文件头和服务头)"></a>2.2.3.5、<strong><code>File header and service header(文件头和服务头)</code></strong></h5><p>&emsp;&emsp;These two header types use the similar data structure, so we describe them both here.<br>&emsp;&emsp;这两种头类型使用相似的数据结构，因此我们在这里对它们一起进行描述。</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Header CRC32</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">头数据的CRC32，从“<code>Header size</code>”字段开始，直至“<code>Name</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">头数据的大小，从“<code>Header type</code>”字段开始，直至“<code>Name</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x02</code> - 文件头 <br> <code>0x03</code> - 服务头</td>
</tr>
<tr>
<td style="text-align:left">Header flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">所有头共有的标志：<br> <code>0x01</code> - 头末尾存在扩展区域。<br> <code>0x02</code> - 头末尾存在数据区域。<br> <code>0x04</code> - 当更新压缩文档时，必须跳过类型未知并拥有该标志的块。<br> <code>0x08</code> - 数据区域从上一卷继续。<br> <code>0x10</code> - 数据区域从下一卷继续。<br> <code>0x20</code> - 块取决于前一个文件块。<br> <code>0x40</code> - 如果修改了主块，则保留一个子块。</td>
</tr>
<tr>
<td style="text-align:left">Extra area size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，扩展区域的大小。仅当设置了<code>0x01</code>头标志时才存在。</td>
</tr>
<tr>
<td style="text-align:left">Data area size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，数据区域的大小。仅当设置了<code>0x02</code>头标志时才存在。</td>
</tr>
<tr>
<td style="text-align:left">File flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">这些头类型专用的标志：<br> &emsp;&emsp;<code>0x01</code> - 目录文件系统对象(文件头)。<br> &emsp;&emsp;<code>0x02</code> - 存在Unix格式的时间字段。<br> &emsp;&emsp;<code>0x04</code> - 存在CRC32字段。<br> &emsp;&emsp;<code>0x08</code> - 解压后大小未知。<br> 如果设置了标志<code>0x08</code>，则“<code>Unpacked size</code>”字段仍然存在，但是必须忽略，并且必须执行提取，直到到达压缩流的末尾。如果实际文件大小大于操作系统报告的大小，或者文件大小未知（例如，除从stdin到multivolume archive归档时的最后一个卷以外的所有卷），则可以设置此标志。</td>
</tr>
<tr>
<td style="text-align:left">Unpacked size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">解压缩的<code>文件</code>或<code>服务数据</code>大小。</td>
</tr>
<tr>
<td style="text-align:left">Attributes</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">如果是<code>文件头</code>，则为操作系统特定的文件属性。如果是<code>服务头</code>，可以用于特定数据需求，也可以保留，并可以设置为0。</td>
</tr>
<tr>
<td style="text-align:left">mtime</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left"><code>可选字段</code>，Unix时间格式的<code>文件修改时间</code>。如果设置了<code>0x02</code>文件标志，则存在。</td>
</tr>
<tr>
<td style="text-align:left">Data CRC32</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left"><code>可选字段</code>，已解压缩的<code>文件</code>或<code>服务数据</code>的CRC32。对于在卷之间分割的文件，它包含当前卷中除最后文件部分以外的所有文件部分所包含的文件打包数据的CRC32。如果设置了<code>0x04</code>文件标志，则存在。</td>
</tr>
<tr>
<td style="text-align:left">Compression information</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>低6位(0x003f)</code>：压缩算法的版本，可能有0-63个值。当前版本是0。<br> <code>第7位(0x0040)</code>：定义solid flag。如果已设置，RAR将在处理之前的文件后继续使用剩下的压缩字典。只能为文件头设置，而不能为服务头设置。<br> <code>第8-10位(0x0380)</code>：定义压缩方法。当前仅使用值0-5。<br> &emsp;&emsp;10 9 8 位<br> &emsp;&emsp;<code>0 0 0</code> - 存储 <br> &emsp;&emsp;<code>0 0 1</code> - 最快压缩 <br> &emsp;&emsp;<code>0 1 0</code> - 较快压缩 <br> &emsp;&emsp;<code>0 1 1</code> - 标准压缩 <br> &emsp;&emsp;<code>1 0 0</code> - 较好压缩 <br> &emsp;&emsp;<code>1 0 1</code> - 最好压缩<br> <code>第11-14位(0x3c00)</code>：定义提取数据所需的字典大小的最小大小。<br> &emsp;&emsp;14 13 12 11 位<br> &emsp;&emsp;<code>0 0 0 0</code> - 字典大小 128KB<br> &emsp;&emsp;<code>0 0 0 1</code> - 字典大小 256KB<br> &emsp;&emsp;<code>0 0 1 0</code> - 字典大小 512KB<br> &emsp;&emsp;<code>0 0 1 1</code> - 字典大小 1MB<br> &emsp;&emsp;<code>0 1 0 0</code> - 字典大小 2MB<br> &emsp;&emsp;<code>0 1 0 1</code> - 字典大小 4MB<br> &emsp;&emsp;<code>0 1 1 0</code> - 字典大小 8MB<br> &emsp;&emsp;<code>0 1 1 1</code> - 字典大小 16MB<br> &emsp;&emsp;<code>1 0 0 0</code> - 字典大小 32MB<br> &emsp;&emsp;<code>1 0 0 1</code> - 字典大小 64MB<br> &emsp;&emsp;<code>1 0 1 0</code> - 字典大小 128MB<br> &emsp;&emsp;<code>1 0 1 1</code> - 字典大小 256MB<br> &emsp;&emsp;<code>1 1 0 0</code> - 字典大小 512MB<br> &emsp;&emsp;<code>1 1 0 1</code> - 字典大小 1024MB<br> &emsp;&emsp;<code>1 1 1 0</code> - 字典大小 2048MB<br> &emsp;&emsp;<code>1 1 1 1</code> - 字典大小 4096MB</td>
</tr>
<tr>
<td style="text-align:left">Host OS</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">用于创建压缩文档的操作系统的类型： <br> <code>0x00</code> - Windows <br> <code>0x01</code> - Unix</td>
</tr>
<tr>
<td style="text-align:left">Name length</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>文件</code>或<code>服务头</code>名称的长度。</td>
</tr>
<tr>
<td style="text-align:left">Name</td>
<td style="text-align:center">N bytes</td>
<td style="text-align:left">1、可变长度字段，包含UTF-8格式的名称，不以0结尾。<br> 2、对于<code>文件头</code>，这是已压缩文件的名称。正斜杠字符用作Unix和Windows名称的路径分隔符。对于Unix文件名称，反斜杠被视为名称的一部分，对于Windows文件名称，反斜杠被视为无效字符。名称类型由“Host OS”字段定义。<br> 3、如果Unix文件名包含无法正确转换为Unicode和UTF-8的任何高级ASCII字符，我们会将这些字符映射到0xE080-0xE0FF私有Unicode区域，并在结果字符串中插入Unicode非字符0xFFFE以表明它包含已映射字符，提取时需要转换回去。没有定义0xFFFE的具体位置，我们需要搜索整个字符串。此类映射的名称不可移植，并且只能在创建它们的同一系统上正确解压缩。<br> 4、对于<code>服务头</code>，此字段包含服务头的名称。现在使用以下名称：<br> <code>CMT</code> - 压缩文档注释 <br> <code>QO</code> - 压缩文档Quick open数据 <br> <code>ACL</code> - NTFS文件权限 <br> <code>STM</code> - NTFS交换数据流 <br> <code>RR</code> - 恢复记录</td>
</tr>
<tr>
<td style="text-align:left">Extra area</td>
<td style="text-align:center">…</td>
<td style="text-align:left"><code>可选字段</code>，扩展区域，包含附加的头字段。仅当设置了<code>0x01</code>头标志时才存在。</td>
</tr>
<tr>
<td style="text-align:left">Data area</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，数据区域，仅当设置了<code>0x02</code>头标志时才存在。如果是<code>文件头</code>，则存储文件数据；对于<code>服务头</code>，则存储服务数据。根据压缩方法中的值，可以对压缩信息进行未压缩（压缩方法0）或压缩。</td>
</tr>
</tbody>
</table>
<p>File and service headers use the same types of extra area records:<br><code>文件头</code>和<code>服务头</code>使用相同类型的扩展区域记录类型：</p>
<table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th style="text-align:left">类型名称</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0x01</td>
<td style="text-align:left">File encryption</td>
<td style="text-align:left">文件加密信息。</td>
</tr>
<tr>
<td style="text-align:left">0x02</td>
<td style="text-align:left">File hash</td>
<td style="text-align:left">文件数据哈希。</td>
</tr>
<tr>
<td style="text-align:left">0x03</td>
<td style="text-align:left">File time</td>
<td style="text-align:left">高精度文件时间。</td>
</tr>
<tr>
<td style="text-align:left">0x04</td>
<td style="text-align:left">File version</td>
<td style="text-align:left">文件版本号。</td>
</tr>
<tr>
<td style="text-align:left">0x05</td>
<td style="text-align:left">Redirection</td>
<td style="text-align:left">文件系统重定向。</td>
</tr>
<tr>
<td style="text-align:left">0x06</td>
<td style="text-align:left">Unix owner</td>
<td style="text-align:left">Unix所有者和组信息。</td>
</tr>
<tr>
<td style="text-align:left">0x07</td>
<td style="text-align:left">Service data</td>
<td style="text-align:left">服务头数据数组。</td>
</tr>
</tbody>
</table>
<p><strong><code>File encryption record(文件加密记录)</code></strong><br>This record is present if file data is encrypted.<br>如果<code>文件数据被加密</code>，则存在该记录。</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code></td>
</tr>
<tr>
<td style="text-align:left">Version</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">加密算法的版本。现在仅支持<code>0版本</code>(AES-256)。</td>
</tr>
<tr>
<td style="text-align:left">Flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code> - 存在密码验证数据。<br> <code>0x02</code> - 使用调整过的校验和而不是普通校验和。<br> 如果存在标志<code>0x02</code>，则RAR转换保留的校验和文件或服务数据的完整性，因此它取决于加密密钥。它使得不可能根据校验和猜测文件内容。它会影响文件头中的数据CRC32和扩展区域中文件哈希记录中的校验和。</td>
</tr>
<tr>
<td style="text-align:left">KDF count</td>
<td style="text-align:center">1 byte</td>
<td style="text-align:left"><code>PBKDF2函数</code>的迭代数的<code>二进制对数</code>。 RAR可以拒绝处理超过<code>某个阈值</code>的KDF计数。阈值的具体值取决于<code>版本</code>。</td>
</tr>
<tr>
<td style="text-align:left">Salt</td>
<td style="text-align:center">16 byte</td>
<td style="text-align:left">设置加密文件<code>解密密钥</code>的盐值。</td>
</tr>
<tr>
<td style="text-align:left">IV</td>
<td style="text-align:center">16 byte</td>
<td style="text-align:left">AES-256<code>初始化向量</code>。</td>
</tr>
<tr>
<td style="text-align:left">Check value</td>
<td style="text-align:center">12 byte</td>
<td style="text-align:left"><code>可选字段</code>，用于验证密码有效性的值。仅当设置了<code>0x01</code>加密标志时才存在。<code>前8个字节</code>是使用额外的PBKDF2轮次计算的，<code>最后4个字节</code>是额外的校验和。与标准<code>Header CRC32</code>一起，我们具有<code>64位校验和</code>，以可靠地<code>验证此字段的完整性</code>并区分<code>无效的密码</code>和<code>损坏的数据</code>。可以在UnRAR源代码中找到更多详细信息。</td>
</tr>
</tbody>
</table>
<p><strong><code>File hash record(文件哈希记录)</code></strong><br>&emsp;&emsp;Only the standard CRC32 checksum can be stored directly in file header. If other hash is used, it is stored in this extra area record:<br>&emsp;&emsp;仅<code>标准CRC32校验和</code>可以直接存储在<code>文件头</code>中。如果使用<code>其他哈希</code>，它将存储在此<code>扩展区域记录</code>中：</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x02</code></td>
</tr>
<tr>
<td style="text-align:left">Hash type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x00</code> - BLAKE2sp哈希函数。</td>
</tr>
<tr>
<td style="text-align:left">Hash data</td>
<td style="text-align:center">N bytes</td>
<td style="text-align:left"><code>0x00哈希类型</code>的32个字节的BLAKE2sp哈希值。</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;For files split between volumes it contains a hash of file packed data contained in current volume for all file parts except the last. For files not split between volumes and for last parts of split files it contains an unpacked data hash.<br>&emsp;&emsp;对于<code>在卷之间分割</code>的文件，它包含当前卷中除最后文件部分以外的所有文件部分所包含的文件压缩数据的哈希。对于<code>未在卷之间拆分</code>的文件以及拆分文件的最后部分，它包含未压缩的数据哈希。</p>
<p><strong><code>File time record(文件时间记录)</code></strong><br>&emsp;&emsp;This record is used if it is necessary to store creation and last access time or if 1 second precision of Unix mtime stored in file header is not enough:<br>&emsp;&emsp;如果需要存储<code>创建</code>和<code>上次访问</code>时间，或者<code>文件头</code>中存储的Unix mtime的1秒<code>精度不够</code>，则使用此记录：</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x03</code></td>
</tr>
<tr>
<td style="text-align:left">Flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code> - 如果设置了此标志，则时间以Unix time_t格式存储，否则以Windows FILETIME格式存储。<br> <code>0x02</code> - 存在“mtime”字段。<br> <code>0x04</code> - 存在“ctime”字段。<br> <code>0x08</code> - 存在“atime”字段。<br> <code>0x10</code> - Unix时间格式，具有纳秒级精度。</td>
</tr>
<tr>
<td style="text-align:left">mtime</td>
<td style="text-align:center">uint32 or uint64</td>
<td style="text-align:left"><code>修改时间</code>。如果设置了<code>0x02</code>标志，则存在。根据<code>0x01</code>，标志可以采用Unix time_t或Windows FILETIME格式。</td>
</tr>
<tr>
<td style="text-align:left">ctime</td>
<td style="text-align:center">uint32 or uint64</td>
<td style="text-align:left"><code>创建时间</code>。如果设置了<code>0x04</code>标志，则存在。根据<code>0x01</code>，标志可以采用Unix time_t或Windows FILETIME格式。</td>
</tr>
<tr>
<td style="text-align:left">atime</td>
<td style="text-align:center">uint32 or uint64</td>
<td style="text-align:left"><code>上次访问时间</code>。如果设置了<code>0x08</code>标志，则存在。根据<code>0x01</code>，标志可以采用Unix time_t或Windows FILETIME格式。</td>
</tr>
<tr>
<td style="text-align:left">mtime nanoseconds</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">添加到<code>mtime</code>的纳秒值。如果<code>0x01</code>、<code>0x02</code>和<code>0x10</code>标志都设置了，则存在。</td>
</tr>
<tr>
<td style="text-align:left">ctime nanoseconds</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">添加到<code>ctime</code>的纳秒值。如果<code>0x01</code>、<code>0x04</code>和<code>0x10</code>标志都设置了，则存在。</td>
</tr>
<tr>
<td style="text-align:left">atime nanoseconds</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">添加到<code>atime</code>的纳秒值。如果<code>0x01</code>、<code>0x08</code>和<code>0x10</code>标志都设置了，则存在。</td>
</tr>
</tbody>
</table>
<p><strong><code>File version record(文件版本记录)</code></strong><br>This record is used in archives created with -ver switch.<br>该记录用于通过<code>-ver开关</code>创建的压缩文档中。</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x04</code></td>
</tr>
<tr>
<td style="text-align:left">Flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">尚未定义文件版本标志，因此将其设置为0。</td>
</tr>
<tr>
<td style="text-align:left">Version number</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">文件版本号。</td>
</tr>
</tbody>
</table>
<p><strong><code>File system redirection record(文件系统重定向记录)</code></strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x05</code></td>
</tr>
<tr>
<td style="text-align:left">Redirection type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code> - Unix符号链接 <br> <code>0x02</code> - Windows符号链接 <br> <code>0x03</code> - Windows交接点 <br> <code>0x04</code> - 硬链接 <br> <code>0x05</code> - 文件复制</td>
</tr>
<tr>
<td style="text-align:left">Flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code> - 链接目标为目录</td>
</tr>
<tr>
<td style="text-align:left">Name length</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">链接目标名称的长度</td>
</tr>
<tr>
<td style="text-align:left">Name</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>UTF-8</code>格式的链接目标名称，不以0结尾</td>
</tr>
</tbody>
</table>
<p><strong><code>Unix owner record(Unix所有者记录)</code></strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x06</code></td>
</tr>
<tr>
<td style="text-align:left">Flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x01</code> - “User name”符串存在 <br> <code>0x02</code> - “Group name”字符串存在 <br> <code>0x04</code> - 存在数字“User ID” <br> <code>0x08</code> - 存在数字“Group ID”</td>
</tr>
<tr>
<td style="text-align:left">User name length</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，所有者用户名的长度。如果设置了<code>0x01</code>标志，则存在。</td>
</tr>
<tr>
<td style="text-align:left">User name</td>
<td style="text-align:center">N bytes</td>
<td style="text-align:left"><code>可选字段</code>，所有者用户名（采用本机编码）。非零终止。如果设置了<code>0x01</code>标志，则存在。</td>
</tr>
<tr>
<td style="text-align:left">Group name length</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，所有者组名称的长度。如果设置了<code>0x02</code>标志，则存在。</td>
</tr>
<tr>
<td style="text-align:left">Group name</td>
<td style="text-align:center">N bytes</td>
<td style="text-align:left"><code>可选字段</code>，所有者组名称（采用本机编码）。非零终止。如果设置了<code>0x02</code>标志，则存在。</td>
</tr>
<tr>
<td style="text-align:left">User ID</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，数字所有者用户ID。如果设置了<code>0x04</code>标志，则存在。</td>
</tr>
<tr>
<td style="text-align:left">Group ID</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>可选字段</code>，数字所有者组ID。如果设置了<code>0x08</code>标志，则存在。</td>
</tr>
</tbody>
</table>
<p><strong><code>Service data record(服务数据记录)</code></strong><br>This record is used only by service headers to store additional parameters.<br>该记录仅由<code>服务头</code>使用，以存储其他参数。</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从Type开始的记录数据的大小。</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x07</code></td>
</tr>
<tr>
<td style="text-align:left">Data</td>
<td style="text-align:center">N bytes</td>
<td style="text-align:left">服务数据的具体内容取决于<code>服务头类型</code>。</td>
</tr>
</tbody>
</table>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/File header.jpg" alt="文件头"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">00310850 - 00311002</span><br><span class="line">FF A6 73 44 - Header CRC32( Header size -&gt; Extra area )</span><br><span class="line">93 01 - Header size( Header <span class="built_in">type</span> -&gt; Extra area )</span><br><span class="line">02 - Header <span class="built_in">type</span>( 文件头 )</span><br><span class="line">03 - Header flags( 0x03 = 0x01 + 0x02 )</span><br><span class="line">6F - Extra area size[ 0x6F = (0x30+0x01) + (0x22+0x01) + (0x1A+0x01) ]</span><br><span class="line">D0 C5 01 - Data area size</span><br><span class="line">00 - File flags                       ‭  </span><br><span class="line">B3 E9 - Unpacked size </span><br><span class="line">01 20 - Attributes    </span><br><span class="line">80 03 - Compression information</span><br><span class="line">00 - Host OS</span><br><span class="line">15 - Name length( 15H = 21D )</span><br><span class="line">32 30 32 30 30 32 30 35 31 31 34 36 31 34 39 34 35 2E 70 6E 67 - Name</span><br><span class="line">30 - Size( Extra area ) 30H = 48D</span><br><span class="line">01 - Type( 文件加密记录 )</span><br><span class="line">00 - Version</span><br><span class="line">03 - Flags( 0x03 = 0x02 + 0x01 )</span><br><span class="line">0F - KDF count</span><br><span class="line">48 2F 76 C7 97 E7 8A 77 D5 55 F8 1F 5F 31 D8 26 - Salt</span><br><span class="line">5C 4C 4F B0 4F 94 01 90 95 95 2E E9 E6 BF 8F 75 - IV</span><br><span class="line">4D 87 A2 57 6C EA BA B2 EB D6 4E A8 - Check value</span><br><span class="line">22 - Size( Extra area ) 22H = 34D</span><br><span class="line">02 - Type( 文件哈希记录 )</span><br><span class="line">00 - Hash <span class="built_in">type</span></span><br><span class="line">16 87 E7 C4 D1 8C 13 AA BD B5 18 4A A9 C7 3E D1 85 85 95 B4 6F 12 3E 55 10 C6 86 7C 5A 2E 80 B9 - Hash data</span><br><span class="line">1A - Size( Extra area ) 1AH = 26D</span><br><span class="line">03 - Type( 文件时间记录 )</span><br><span class="line">0E - Flags( 0x0E = 0x02 + 0x04 + 0x08 )</span><br><span class="line">8C E5 A3 8C 2A 01 D6 01 - mtime</span><br><span class="line">7D A3 8E 8E 2A 01 D6 01 - ctime</span><br><span class="line">87 27 7A 12 2D 2D D6 01 - atime                           </span><br><span class="line">Data area: 00311003 - 00336298  25296B(压缩后大小)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Note: vint类型的数据，如果是多字节的，前几个字节的最高位为连续标志</span><br><span class="line">(设为1)，低7位为数据，最后一个字节的最高位为0，低7位依旧是数据。所</span><br><span class="line">以我们需要提取出数据，进行重新组合，才能得到“Quick open header”</span><br><span class="line">和“Recovery record”真实偏移。</span><br><span class="line">1、Header size</span><br><span class="line">0x0193( 00000001 10010011 )</span><br><span class="line">0000001 0010011B = 10010011B = 93H = 147D</span><br><span class="line">2、Data area size</span><br><span class="line">0x01C5D0( 00000001 ‭11000101 11010000‬ )</span><br><span class="line">0000001 1000101 1010000‬B = 01100010 11010000‬B = 62D0H = 25296D</span><br><span class="line">3、Unpacked size</span><br><span class="line">0xE9B3( ‭11101001 10110011‬ )</span><br><span class="line">11101001 0110011B = ‬01110100 10110011B = 74B3H = ‭29875‬D</span><br><span class="line">4、Compression information</span><br><span class="line">0x0380( 00000011 10000000 )</span><br><span class="line">0000011 0000000B = 0000 011 0 000000B</span><br><span class="line">( 0000 - 字典大小128KB、011 - 标准压缩、0 - solid flag、000000 - 压缩算法版本 )</span><br><span class="line">5、FILETIME</span><br><span class="line">(1)https://support.microsoft.com/zh-cn/<span class="built_in">help</span>/188768/info-working-with-the-filetime-structure</span><br><span class="line">(2)https://www.pressc.cn/123.html</span><br><span class="line">(3)http://www.beijing-time.org/riqi.htm</span><br><span class="line">ctime</span><br><span class="line">7D A3 8E 8E 2A 01 D6 01  2020/05/19 00:24:42</span><br><span class="line">dwLowDateTime dwHighDateTime   </span><br><span class="line">0x8E8EA37D    0x01D6012A</span><br><span class="line">0x01D6012A8E8EA37D = ‭132294521345975165‬</span><br><span class="line">153175.0039699074*24*60*60*10000000 = 132343203429999993.6‬</span><br><span class="line">42*10000000 + 24*60*10000000 = 14820000000‬</span><br><span class="line">132343203429999993.6‬ + 14820000000‬ = 132343218249999993.6</span><br><span class="line">                                     132294521345975165‬</span><br><span class="line">----------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h5 id="2-2-3-6、Recovery-record-恢复记录"><a href="#2-2-3-6、Recovery-record-恢复记录" class="headerlink" title="2.2.3.6、Recovery record(恢复记录)"></a>2.2.3.6、<strong><code>Recovery record(恢复记录)</code></strong></h5><p>&emsp;&emsp;加入冗余数据用于修复，在<code>压缩包本身损坏</code>但<code>恢复记录够多</code>时可对损坏压缩包进行恢复。<br><strong><code>实例：</code></strong><br>我们可以从例子RAR环境的图片中看到,恢复记录的大小约为19.6KB。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">336483 - 356643  (20161B 恢复记录)</span><br><span class="line">20161B/1024 = 19.6KB</span><br></pre></td></tr></table></figure></p>
<h5 id="2-2-3-7、End-of-archive-header-结尾块"><a href="#2-2-3-7、End-of-archive-header-结尾块" class="headerlink" title="2.2.3.7、End of archive header(结尾块)"></a>2.2.3.7、<strong><code>End of archive header(结尾块)</code></strong></h5><p>&emsp;&emsp;End of archive marker. RAR does not read anything after this header letting to use third party tools to add extra information such as a digital signature to archive.<br>&emsp;&emsp;标记<code>压缩文档结束</code>。 RAR在此头之后不读取任何内容，从而允许使用<code>第三方工具</code>来添加<code>扩展的信息</code>，例如<code>压缩文档的数字签名</code>。</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Header CRC32</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">头数据的CRC32，从“<code>Header size</code>”字段开始，直至“<code>End of archive flags</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">头数据的大小，从“<code>Header type</code>”字段开始，直至“<code>End of archive flags</code>”字段。</td>
</tr>
<tr>
<td style="text-align:left">Header type</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x05</code></td>
</tr>
<tr>
<td style="text-align:left">Header flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">所有头共有的标志：<br> <code>0x01</code> - 头末尾存在扩展区域。<br> <code>0x02</code> - 头末尾存在数据区域。<br> <code>0x04</code> - 当更新压缩文档时，必须跳过类型未知并拥有该标志的块。<br> <code>0x08</code> - 数据区域从上一卷继续。<br> <code>0x10</code> - 数据区域从下一卷继续。<br> <code>0x20</code> - 块取决于前一个文件块。<br> <code>0x40</code> - 如果修改了主块，则保留一个子块。</td>
</tr>
<tr>
<td style="text-align:left">End of archive flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left"><code>0x00</code> - 压缩文档不使用卷分割。或是集合中的最后一个卷。 <br> <code>0x01</code> - 压缩文档是卷，不是集合中的最后一个卷。</td>
</tr>
</tbody>
</table>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/End of archive header.jpg" alt="结尾块"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00356644 - 00356651</span><br><span class="line">1D 77 56 51 - Header CRC32( Header size -&gt; End of archive flags )</span><br><span class="line">03 - Header size( Header size -&gt; End of archive flags ) 03H = 3D</span><br><span class="line">05 - Header <span class="built_in">type</span>( 结尾块 )</span><br><span class="line">04 - Header flags( 0x04 )</span><br><span class="line">00 - End of archive flags</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4、Service-headers-服务头"><a href="#2-2-4、Service-headers-服务头" class="headerlink" title="2.2.4、Service headers(服务头)"></a>2.2.4、Service headers(服务头)</h4><p>&emsp;&emsp;RAR uses service headers based on the file header data structure to store different supplementary information.<br>&emsp;&emsp;RAR使用基于<code>文件头数据结构</code>的<code>服务头</code>来存储不同的补充信息。</p>
<h5 id="2-2-4-1、Archive-comment-header-压缩文档注释服务头"><a href="#2-2-4-1、Archive-comment-header-压缩文档注释服务头" class="headerlink" title="2.2.4.1、Archive comment header(压缩文档注释服务头)"></a>2.2.4.1、<strong><code>Archive comment header(压缩文档注释服务头)</code></strong></h5><p>&emsp;&emsp;Optional header storing the main archive comment. Contains CMT identifier in file name field. Placed before any file headers and after the main archive header. Comment data is stored in UTF-8 immediately after the archive comment header. Now RAR does not use compression for archive comments, so packed and unpacked data sizes in header are equal and they both define the comment data size. Compression method in header is set to 0.<br>&emsp;&emsp;可选的头，用于存储<code>压缩文档注释</code>。在<code>文件名字段</code>中包含<code>CMT标识符</code>。放在<code>任何文件头</code>之前和<code>压缩文档头</code>之后。<code>注释数据</code>在<code>压缩文档注释头</code>之后用UTF-8存储。现在，RAR不对<code>压缩文件注释</code>使用压缩，因此头中的<code>压缩数据大小</code>和<code>未压缩数据大小</code>相等，并且它们都定义了<code>注释数据大小</code>。头中的<code>压缩方法</code>设置为0。</p>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/Archive comment header.jpg" alt="压缩文档注释服务头"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">00310812 - 00310849</span><br><span class="line">EF 0D 46 57 - Header CRC32( Header size -&gt; Name )</span><br><span class="line">13 - Header size( Header <span class="built_in">type</span> -&gt; Name ) 13H = 19B</span><br><span class="line">03 - Header <span class="built_in">type</span>( 服务头 )</span><br><span class="line">02 - Header flags( 0x02 )</span><br><span class="line">8E 00 - Data area size</span><br><span class="line">04 - File flags( 0x04 )</span><br><span class="line">8E 00 - Unpacked size</span><br><span class="line">00 - Attributes</span><br><span class="line">F5 88 A4 AC - Data CRC32( 77 77 77 2E 62 61 69 64 75 2E 63 6F 6D 00 )</span><br><span class="line">80 00 - Compression information</span><br><span class="line">00 - Host OS	</span><br><span class="line">03 - Name length( 03H = 3D )</span><br><span class="line">43 4D 54 - Name( CMT - 压缩文档注释 )                                                          </span><br><span class="line">77 77 77 2E 62 61 69 64 75 2E 63 6F 6D 00 - Data area( www.baidu.com )</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Note: vint类型的数据，如果是多字节的，前几个字节的最高位为连续标志</span><br><span class="line">(设为1)，低7位为数据，最后一个字节的最高位为0，低7位依旧是数据。所</span><br><span class="line">以我们需要提取出数据，进行重新组合，才能得到“Quick open header”</span><br><span class="line">和“Recovery record”真实偏移。</span><br><span class="line">1、Data size &amp;&amp; Unpacked size</span><br><span class="line">0x008E( 00000000 10001110 )</span><br><span class="line">0001110B = 00001110B = EH = 14D</span><br><span class="line">2、Compression information</span><br><span class="line">0x0080( 00000000 10000000 )</span><br><span class="line">0000000 0000000B = 0000 000 0 000000B</span><br><span class="line">( 0000 - 字典大小128KB、000 - 存储、0 - solid flag、000000 - 压缩算法版本 )</span><br><span class="line">----------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h5 id="2-2-4-2、Quick-open-header-快速打开服务头"><a href="#2-2-4-2、Quick-open-header-快速打开服务头" class="headerlink" title="2.2.4.2、Quick open header(快速打开服务头)"></a>2.2.4.2、<strong><code>Quick open header(快速打开服务头)</code></strong></h5><p>&emsp;&emsp;Optional header storing the quick open record. Contains QO identifier in file name field. Placed after all file headers, but before the recovery record and end of archive header. It is possible to locate the quick open header with locator record in main archive header.<br>&emsp;&emsp;可选的头，用于存储<code>快速打开记录</code>。在<code>文件名</code>字段中包含<code>QO标识符</code>。置于<code>所有文件头</code>之后，但在<code>恢复记录</code>和<code>压缩文档结尾块</code>之前。可以在<code>压缩文档头</code>中找到带有定位记录的<code>快速打开头</code>。<br>&emsp;&emsp;Quick open record data is stored immediately after the quick open header. RAR does not use compression for quick open data, so packed and unpacked data sizes in header are equal and they both define the quick open data size. Compression method in header is set to 0.<br>&emsp;&emsp;<code>快速打开记录数据</code>将立即存储在<code>快速打开头</code>之后。 RAR不对<code>快速打开数据</code>使用压缩，因此头中的<code>压缩数据大小</code>和<code>未压缩数据大小</code>相等，并且它们都定义了<code>快速打开数据大小</code>。头中的压缩方法设置为0。<br>&emsp;&emsp;Quick open data is the array consisting of data cache structures. Every data cache structure stores a portion of archived data and has the following format:<br>&emsp;&emsp;<code>快速打开数据</code>是由<code>数据缓存结构</code>组成的数组。<code>每个数据缓存结构</code>都存储<code>一部分压缩数据</code>，并具有以下格式：</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段名称</th>
<th style="text-align:center">大小(类型)</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Structure CRC32</td>
<td style="text-align:center">uint32</td>
<td style="text-align:left">从“<code>Structure size</code>”字段开始的结构数据的<code>CRC32</code>。</td>
</tr>
<tr>
<td style="text-align:left">Structure size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从<code>标志字段</code>开始的结构数据的大小。在当前实现中，该字段不得超过<code>3个字节</code>，因此最大大小为<code>2 MB</code>。</td>
</tr>
<tr>
<td style="text-align:left">Flags</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">当前设置为0。</td>
</tr>
<tr>
<td style="text-align:left">Offset</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">从<code>快速打开头的开始</code>到当前结构中缓存的<code>压缩文档数据的开始</code>的偏移量。我们可以使用该值来计算存储当前结构的<code>压缩数据的绝对位置</code>。从结构数组的开头到结尾，可以保证数据缓存结构引用的绝对存档位置始终在增长。</td>
</tr>
<tr>
<td style="text-align:left">Data size</td>
<td style="text-align:center">vint</td>
<td style="text-align:left">当前结构中存储的<code>压缩文档数据的大小</code>。</td>
</tr>
<tr>
<td style="text-align:left">Data</td>
<td style="text-align:center">N bytes</td>
<td style="text-align:left">存储在当前结构中的<code>压缩文档数据</code>。</td>
</tr>
</tbody>
</table>
<p>&emsp;&emsp;Normally RAR uses the quick open data to store copies of file and service headers. It can store either all headers or only a part of them. If required header is missing in quick open data or if structure CRC32 is invalid, data are read from its original archive position.<br>&emsp;&emsp;通常，RAR使用<code>快速打开数据</code>来存储<code>文件的副本</code>和<code>服务头</code>。它可以存储<code>所有头</code>，也可以只存储<code>其中的一部分</code>。如果快速打开数据中<code>缺少必需的标头</code>，或者结构<code>CRC32无效</code>，则从其<code>原始存档位置</code>读取数据。<br>&emsp;&emsp;Using the quick open data is optional. You can skip it completely and read only standard archive headers. But it is important to use the same access pattern when reading file names to display them to user and to extract files. Otherwise it would be possible to see one file name and extract another in case the quick open data and real archive data are intentionally created different. It could introduce a security threat. So if you use the quick open data when displaying the archive contents, use it when extracting. If you do not use it when displaying the archive contents, do not use it when extracting.<br>&emsp;&emsp;使用<code>快速打开数据</code>是可选的。您可以完全跳过它，而仅读取<code>标准压缩文档头</code>。但是，重要的是在<code>读取文件名</code>时使用相同的访问模式以将其<code>显示给用户</code>并<code>提取文件</code>。否则，如果有意创建的<code>快速打开数据</code>和<code>实际存档数据</code>不同，则可能会看到<code>一个文件名</code>并提取<code>另一个文件名</code>。它可能会带来安全威胁。因此，如果在<code>显示存档内容时</code>使用快速打开的数据，请在<code>提取时</code>使用它。如果在<code>显示存档内容时</code>不使用它，则在<code>提取时</code>不要使用它。</p>
<p><strong><code>实例：</code></strong><br><img src="/resources/2020/RAR_Format/Quick open header.jpg" alt="快速打开服务头"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">00336299 - 00336482  </span><br><span class="line">C3 CA 91 FD - Header CRC32( Header size -&gt; Name )</span><br><span class="line">0E - Header size( Header size -&gt; Name ) 0EH = 14D</span><br><span class="line">03 - Header <span class="built_in">type</span>( 服务头 ) </span><br><span class="line">06 - Header flags( 0x06 = 0x02 + 0x04 )</span><br><span class="line">A5 01 - Data area size</span><br><span class="line">00 - File flags</span><br><span class="line">A5 01 - Unpacked size</span><br><span class="line">00 - Attributes</span><br><span class="line">80 00 - Compression information</span><br><span class="line">00 - Host OS</span><br><span class="line">02 - Name length( 02H = 2D )</span><br><span class="line">51 4F - Name( QO - 快速打开头 )   </span><br><span class="line">16 E8 D1 20 - Structure CRC32( Structure size -&gt; Data ) Data area(快速打开记录数据)</span><br><span class="line">9F 01 - Structure size( Structure size -&gt; Data )</span><br><span class="line">00 - Flags</span><br><span class="line">E9 C6 01 - Offset</span><br><span class="line">99 01 - Data size</span><br><span class="line">FF A6 73 44 - Header CRC32( Header size -&gt; Extra area ) Data</span><br><span class="line">93 01 - Header size( Header <span class="built_in">type</span> -&gt; Extra area )</span><br><span class="line">02 - Header <span class="built_in">type</span>( 文件头 )</span><br><span class="line">03 - Header flags( 0x03 = 0x01 + 0x02 )</span><br><span class="line">6F - Extra area size[ 0x6F = (0x30+0x01) + (0x22+0x01) + (0x1A+0x01) ]</span><br><span class="line">D0 C5 01 - Data area size</span><br><span class="line">00 - File flags                       ‭  </span><br><span class="line">B3 E9 - Unpacked size </span><br><span class="line">01 20 - Attributes    </span><br><span class="line">80 03 - Compression information</span><br><span class="line">00 - Host OS</span><br><span class="line">15 - Name length( 15H = 21D )</span><br><span class="line">32 30 32 30 30 32 30 35 31 31 34 36 31 34 39 34 35 2E 70 6E 67 - Name</span><br><span class="line">30 - Size( Extra area ) 30H = 48D</span><br><span class="line">01 - Type( 文件加密记录 )</span><br><span class="line">00 - Version</span><br><span class="line">03 - Flags( 0x03 = 0x02 + 0x01 )</span><br><span class="line">0F - KDF count</span><br><span class="line">48 2F 76 C7 97 E7 8A 77 D5 55 F8 1F 5F 31 D8 26 - Salt</span><br><span class="line">5C 4C 4F B0 4F 94 01 90 95 95 2E E9 E6 BF 8F 75 - IV</span><br><span class="line">4D 87 A2 57 6C EA BA B2 EB D6 4E A8 - Check value</span><br><span class="line">22 - Size( Extra area ) 22H = 34D</span><br><span class="line">02 - Type( 文件哈希记录 )</span><br><span class="line">00 - Hash <span class="built_in">type</span></span><br><span class="line">16 87 E7 C4 D1 8C 13 AA BD B5 18 4A A9 C7 3E D1 85 85 95 B4 6F 12 3E 55 10 C6 86 7C 5A 2E 80 B9 - Hash data</span><br><span class="line">1A - Size( Extra area ) 1AH = 26D</span><br><span class="line">03 - Type( 文件时间记录 )</span><br><span class="line">0E - Flags( 0x0E = 0x02 + 0x04 + 0x08 )</span><br><span class="line">8C E5 A3 8C 2A 01 D6 01 - mtime</span><br><span class="line">7D A3 8E 8E 2A 01 D6 01 - ctime</span><br><span class="line">87 27 7A 12 2D 2D D6 01 - atime 	</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Note: vint类型的数据，如果是多字节的，前几个字节的最高位为连续标志</span><br><span class="line">(设为1)，低7位为数据，最后一个字节的最高位为0，低7位依旧是数据。所</span><br><span class="line">以我们需要提取出数据，进行重新组合，才能得到“Quick open header”</span><br><span class="line">和“Recovery record”真实偏移。</span><br><span class="line">1、Data area size &amp;&amp; Unpacked size</span><br><span class="line">0x01A5( 00000001 10100101 )</span><br><span class="line">0000001 0100101B = 10100101B = A5H = 165D</span><br><span class="line">2、Compression information	</span><br><span class="line">0x0080( 00000000 10000000 )</span><br><span class="line">0000000 0000000B = 0000 000 0 000000B</span><br><span class="line">( 0000 - 字典大小128KB、000 - 存储、0 - solid flag、000000 - 压缩算法版本 )</span><br><span class="line">3、Structure size</span><br><span class="line">0x019F( 00000001 10011111 )</span><br><span class="line">0000001 0011111B = 10011111B = 9FH = 159D</span><br><span class="line">4、Offset</span><br><span class="line">0x01C6E9( 00000001 11000110 11101001 )</span><br><span class="line">0000001 1000110 1101001B = 01100011 01101001B = 6369H = ‭25449‬D</span><br><span class="line">336299 - 25449 = 310850(文件头起始偏移)</span><br><span class="line">5、Data size</span><br><span class="line">0x0199( 00000001 10011001 )</span><br><span class="line">0000001 0011001B = 10011001B = 99H = 153D</span><br><span class="line">----------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3、针对RAR的主要攻击方式"><a href="#3、针对RAR的主要攻击方式" class="headerlink" title="3、针对RAR的主要攻击方式"></a>3、针对RAR的主要攻击方式</h2><h3 id="3-1、爆破"><a href="#3-1、爆破" class="headerlink" title="3.1、爆破"></a>3.1、爆破</h3><p>RAR 5.0 密码破解<br><a href="https://blog.xugr.me/post/rar-crack/" target="_blank" rel="noopener">https://blog.xugr.me/post/rar-crack/</a></p>
<h3 id="3-2、伪加密"><a href="#3-2、伪加密" class="headerlink" title="3.2、伪加密"></a>3.2、伪加密</h3><p>&emsp;&emsp;<code>伪加密</code>只发生在<code>RAR5.0以前的版本</code>中，我们只需要修改<code>FILE_HEAD</code>中的<code>HEAD_FLAGS</code>的<code>0x0004</code>标记为1，就可以造成<code>RAR伪加密</code>。</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2020/04/10/RAR文件格式分析/">RAR文件格式分析</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 Sp4n9x 的个人博客">Sp4n9x</a></p>
        <p><span>发布时间:</span>2020-04-10, 00:00</p>
        <p><span>最后更新:</span>2020-09-12, 23:29</p>
        
            <p>
                <span>更新历史:</span><i class="fa fa-github"></i>
                <a href="https://github.com/Sp4n9x/blog_backup/blob/master/_posts/2020-04-10.RAR文件格式分析.md" title="顺序查看文章各部分修改记录" target = "_blank">Blame</a>,
                <a href="https://github.com/Sp4n9x/blog_backup/blob/master/_posts/2020-04-10.RAR文件格式分析.md" title="查看文章有关更新记录" target = "_blank">History</a><span class="raw">文本模式:</span><i class="fa fa-file-text-o"></i>
                <a href="https://raw.githubusercontent.com/Sp4n9x/blog_backup/blob/master/_posts/2020-04-10.RAR文件格式分析.md" title="查看 & 下载文章 Markdown 原始文本" target = "_blank"> .md Raw</a>
            </p>
        
        <p>
            <span>原始链接:</span><a class="post-url" href="/2020/04/10/RAR文件格式分析/" title="RAR文件格式分析">http://sp4n9x.github.io/2020/04/10/RAR文件格式分析/</a>
            <span class="copy-path" data-clipboard-text="原文: http://sp4n9x.github.io/2020/04/10/RAR文件格式分析/　　作者: Sp4n9x" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>

    
    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2020/05/08/ZIP文件格式分析/">
                    ZIP文件格式分析
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2019/04/11/OilRig新型BondUpdater木马的DNS隐蔽隧道通信行为分析/">
                    OilRig新型BondUpdater木马的DNS隐蔽隧道通信行为分析
                </a>
            </div>
        
    </nav>

  
</article>






    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、RAR简介"><span class="toc-text">1、RAR简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1、RAR的历史版本"><span class="toc-text">1.1、RAR的历史版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、RAR压缩文件格式分析"><span class="toc-text">2、RAR压缩文件格式分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1、RAR-1-5-4-0文件格式分析"><span class="toc-text">2.1、RAR 1.5 - 4.0文件格式分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1、标记块-MARK-HEAD"><span class="toc-text">2.1.1、标记块( MARK_HEAD )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2、压缩文件头-MAIN-HEAD"><span class="toc-text">2.1.2、压缩文件头( MAIN_HEAD )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3、文件头-FILE-HEAD"><span class="toc-text">2.1.3、文件头( FILE_HEAD )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4、结尾块-ENDARC-HEAD"><span class="toc-text">2.1.4、结尾块( ENDARC_HEAD )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5、旧风格的块类型"><span class="toc-text">2.1.5、旧风格的块类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2、RAR-5-文件格式分析"><span class="toc-text">2.2、RAR 5+文件格式分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1、Data-types-数据类型"><span class="toc-text">2.2.1、Data types(数据类型)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2、General-archive-structure-通用压缩文档结构"><span class="toc-text">2.2.2、General archive structure(通用压缩文档结构)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3、Archive-blocks-压缩文档块"><span class="toc-text">2.2.3、Archive blocks(压缩文档块)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-1、Self-extracting-module-SFX-自解压模块"><span class="toc-text">2.2.3.1、Self-extracting module (SFX)(自解压模块)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-2、RAR-5-0-signature-RAR5-0签名"><span class="toc-text">2.2.3.2、RAR 5.0 signature(RAR5.0签名)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-3、Archive-encryption-header-压缩文档加密块"><span class="toc-text">2.2.3.3、Archive encryption header(压缩文档加密块)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-4、Main-archive-header-压缩文件头"><span class="toc-text">2.2.3.4、Main archive header(压缩文件头)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-5、File-header-and-service-header-文件头和服务头"><span class="toc-text">2.2.3.5、File header and service header(文件头和服务头)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-6、Recovery-record-恢复记录"><span class="toc-text">2.2.3.6、Recovery record(恢复记录)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-7、End-of-archive-header-结尾块"><span class="toc-text">2.2.3.7、End of archive header(结尾块)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4、Service-headers-服务头"><span class="toc-text">2.2.4、Service headers(服务头)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-4-1、Archive-comment-header-压缩文档注释服务头"><span class="toc-text">2.2.4.1、Archive comment header(压缩文档注释服务头)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-4-2、Quick-open-header-快速打开服务头"><span class="toc-text">2.2.4.2、Quick open header(快速打开服务头)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、针对RAR的主要攻击方式"><span class="toc-text">3、针对RAR的主要攻击方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1、爆破"><span class="toc-text">3.1、爆破</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2、伪加密"><span class="toc-text">3.2、伪加密</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-6 i,
        .toc-level-6 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"true"];
    </script>



    
    <div class="share">
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"RAR文件格式分析　| Sp4n9x's Blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    </div>




    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = 'http://sp4n9x.github.io/2020/04/10/RAR文件格式分析/';
            this.page.identifier = '2020/04/10/RAR文件格式分析/';
        };
        var loadComment = function() {
            var d = document, s = d.createElement('script');
            s.src = '//Sp4n9x.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


<script id="dsq-count-scr" src="//Sp4n9x.disqus.com/count.js" async></script>
<span class="disqus-comment-count" data-disqus-identifier="2020/04/10/RAR文件格式分析/"></span>
<span class="disqus-comment-count" data-disqus-url="http://sp4n9x.github.io/2020/04/10/RAR文件格式分析/"></span>
<script>
    $(".disqus-comment-count").hide();
    var $disqusCount = $(".disqus-comment-count");
    $disqusCount.bind("DOMNodeInserted", function(e) {
        $(".count-comment").text(
            $(this).text().replace(/[^0-9]/ig,"")
        )
        DISQUSWIDGETS.getCount({reset: true});
    })
</script>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2020/05/08/ZIP文件格式分析/" title="上一篇: ZIP文件格式分析">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2019/04/11/OilRig新型BondUpdater木马的DNS隐蔽隧道通信行为分析/" title="下一篇: OilRig新型BondUpdater木马的DNS隐蔽隧道通信行为分析">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/01/10/CVE-2010-2553复现与分析/">CVE-2010-2553复现与分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/30/AVI文件格式分析/">AVI文件格式分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/20/CVE-2010-3333复现与分析/">CVE-2010-3333复现与分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/15/ret2_dl_runtime_resolve详解/">ret2_dl_runtime_resolve详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/19/RCTF2015——WriteUp(Pwn)/">RCTF2015——WriteUp(Pwn)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/05/ZCTF2016——WriteUp(Pwn)/">ZCTF2016——WriteUp(Pwn)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/08/ZIP文件格式分析/">ZIP文件格式分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/10/RAR文件格式分析/">RAR文件格式分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/11/OilRig新型BondUpdater木马的DNS隐蔽隧道通信行为分析/">OilRig新型BondUpdater木马的DNS隐蔽隧道通信行为分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/26/护网杯2018——WriteUp/">护网杯2018——WriteUp</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/01/CVE-2010-2883复现与分析/">CVE-2010-2883复现与分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/27/redhat2018—writeup/">redhat2018—writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/11/一步一步学ROP之Linux_x64篇-蒸米/">一步一步学ROP之Linux_x64篇-蒸米</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/10/一步一步学ROP之Linux_x86篇-蒸米/">一步一步学ROP之Linux_x86篇-蒸米</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/08/Kali2018-搜狗输入法安装/">Kali2018-搜狗输入法安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/05/Pwn环境搭建-Ubuntu16.04/">Pwn环境搭建——Ubuntu16.04</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/23/pwnable.kr/">pwnable.kr</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/27/MySQL宽字节注入/">MySQL宽字节注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/实验吧Wirteup合集/">实验吧WriteUp合集</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2018-2021 Sp4n9x
            </div>
            <div class="footer-right">
                <span> Sp4n9x's Blog <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
    </div>
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 10;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
             post: ".article-entry a[href]", 
             tags: ".article-tag a", 
             categories: ".article-category a, a.tag-list-link", 
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
    <!-- 点击爱心效果 -->
    <script src="/js/love.js"></script>
  </div>
</body>
</html>